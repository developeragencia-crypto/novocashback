import{u as I,a as L,b as S,c as q,r as z,d as B,j as e,D as _,B as l,A as Q,L as u,R as M,C as m,e as t,f as x,g as r,h as c,i as g,k as N,l as f,m as y,n as v,o as G,p as b,q as n,s as F,S as H,t as V,Q as K,v as d}from"./index-cZ1tXq9L.js";function $(){I();const{toast:o}=L(),[,h]=S(),i=q().id,[p,j]=z.useState(!1),{data:s,isLoading:w,isError:C,refetch:D}=B({queryKey:["/api/merchant/payment",i],queryFn:async()=>{try{const a=await fetch(`/api/merchant/payment/${i}`,{credentials:"include"});if(!a.ok)throw new Error("Não foi possível carregar os detalhes do pagamento");return await a.json()}catch(a){throw console.error("Erro ao carregar detalhes do pagamento:",a),a}},enabled:!!i,refetchInterval:5e3}),k=async()=>{j(!0);try{await D(),o({title:"Atualizado",description:"Dados do pagamento atualizados com sucesso."})}catch{o({title:"Erro ao atualizar",description:"Não foi possível atualizar os dados do pagamento.",variant:"destructive"})}finally{j(!1)}},P=()=>{h("/merchant/dashboard")},E=()=>{o({title:"Recibo enviado",description:"O recibo foi enviado ao cliente por e-mail."})},R=a=>{switch(a){case"completed":case"success":case"approved":return e.jsxs(d,{className:"bg-green-500 text-white",children:[e.jsx(g,{className:"w-4 h-4 mr-1"})," Aprovado"]});case"pending":case"waiting":return e.jsxs(d,{className:"bg-orange-500 text-white",children:[e.jsx(N,{className:"w-4 h-4 mr-1"})," Pendente"]});case"failed":case"declined":case"error":return e.jsxs(d,{className:"bg-red-500 text-white",children:[e.jsx(f,{className:"w-4 h-4 mr-1"})," Recusado"]});default:return e.jsxs(d,{className:"bg-gray-500 text-white",children:[e.jsx(x,{className:"w-4 h-4 mr-1"})," Desconhecido"]})}},A=a=>{switch(a){case"cash":return"Dinheiro";case"credit_card":return"Cartão de Crédito";case"debit_card":return"Cartão de Débito";case"wallet":return"Carteira Digital";case"bonus":return"Bônus/Cashback";default:return a||"Desconhecido"}};return e.jsx(_,{title:"Detalhes do Pagamento",type:"merchant",children:e.jsxs("div",{className:"container max-w-3xl mx-auto",children:[e.jsxs("div",{className:"mb-6 flex items-center",children:[e.jsxs(l,{onClick:P,variant:"ghost",size:"sm",children:[e.jsx(Q,{className:"w-4 h-4 mr-2"})," Voltar"]}),e.jsx("h1",{className:"text-2xl font-bold ml-4",children:"Detalhes do Pagamento"}),e.jsx(l,{onClick:k,variant:"ghost",size:"sm",className:"ml-auto",disabled:p,children:p?e.jsx(u,{className:"w-4 h-4 animate-spin"}):e.jsx(M,{className:"w-4 h-4"})})]}),w?e.jsx(m,{className:"w-full p-8",children:e.jsxs("div",{className:"flex justify-center items-center h-40",children:[e.jsx(u,{className:"w-8 h-8 animate-spin text-primary"}),e.jsx("span",{className:"ml-2",children:"Carregando detalhes do pagamento..."})]})}):C?e.jsxs(t,{variant:"destructive",children:[e.jsx(x,{className:"h-4 w-4"}),e.jsx(r,{children:"Erro ao carregar"}),e.jsx(c,{children:"Não foi possível carregar os detalhes do pagamento. Tente novamente."})]}):s?e.jsxs(e.Fragment,{children:[s.status==="completed"||s.status==="success"||s.status==="approved"?e.jsxs(t,{className:"mb-6 bg-green-50 border-green-200",children:[e.jsx(g,{className:"h-5 w-5 text-green-600"}),e.jsx(r,{className:"text-green-800",children:"Pagamento aprovado"}),e.jsx(c,{className:"text-green-700",children:"Este pagamento foi processado com sucesso."})]}):s.status==="pending"||s.status==="waiting"?e.jsxs(t,{className:"mb-6 bg-orange-50 border-orange-200",children:[e.jsx(N,{className:"h-5 w-5 text-orange-600"}),e.jsx(r,{className:"text-orange-800",children:"Pagamento pendente"}),e.jsx(c,{className:"text-orange-700",children:"Este pagamento ainda está sendo processado."})]}):e.jsxs(t,{className:"mb-6 bg-red-50 border-red-200",variant:"destructive",children:[e.jsx(f,{className:"h-5 w-5"}),e.jsx(r,{children:"Pagamento não aprovado"}),e.jsx(c,{children:"Este pagamento foi recusado ou ocorreu um erro no processamento."})]}),e.jsxs(m,{className:"mb-6",children:[e.jsxs(y,{children:[e.jsx(v,{children:"Informações da Transação"}),e.jsx(G,{children:"Detalhes completos desta transação"})]}),e.jsxs(b,{children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-500",children:"ID da Transação"}),e.jsx("p",{className:"text-lg font-medium",children:s.id||i})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-500",children:"Valor"}),e.jsx("p",{className:"text-2xl font-bold text-green-600",children:n(s.amount)})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-500",children:"Status"}),e.jsx("div",{className:"mt-1",children:R(s.status)})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-500",children:"Método de Pagamento"}),e.jsx("p",{className:"text-lg",children:A(s.payment_method||s.paymentMethod)})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-500",children:"Data/Hora"}),e.jsx("p",{className:"text-lg",children:F(s.created_at||s.date)})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-500",children:"Cliente"}),e.jsx("p",{className:"text-lg",children:s.client_name||s.customer||"Cliente não identificado"})]}),s.cashback&&e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-500",children:"Cashback Gerado"}),e.jsx("p",{className:"text-lg text-primary",children:n(s.cashback)})]}),s.description&&e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-500",children:"Descrição"}),e.jsx("p",{className:"text-lg",children:s.description})]})]})]}),e.jsx(H,{className:"my-6"}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4 justify-end",children:[e.jsxs(l,{variant:"outline",onClick:E,children:[e.jsx(V,{className:"w-4 h-4 mr-2"})," Enviar Recibo"]}),e.jsxs(l,{onClick:()=>h("/merchant/payment-qr"),children:[e.jsx(K,{className:"w-4 h-4 mr-2"})," Gerar Novo QR Code"]})]})]})]}),s.items&&s.items.length>0&&e.jsxs(m,{children:[e.jsx(y,{children:e.jsx(v,{children:"Itens da Compra"})}),e.jsx(b,{children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b",children:[e.jsx("th",{className:"px-4 py-2 text-left font-medium",children:"Produto"}),e.jsx("th",{className:"px-4 py-2 text-right font-medium",children:"Qtd"}),e.jsx("th",{className:"px-4 py-2 text-right font-medium",children:"Preço"}),e.jsx("th",{className:"px-4 py-2 text-right font-medium",children:"Total"})]})}),e.jsxs("tbody",{children:[s.items.map((a,T)=>e.jsxs("tr",{className:"border-b",children:[e.jsx("td",{className:"px-4 py-3",children:a.name||a.product_name}),e.jsx("td",{className:"px-4 py-3 text-right",children:a.quantity}),e.jsx("td",{className:"px-4 py-3 text-right",children:n(a.price)}),e.jsx("td",{className:"px-4 py-3 text-right",children:n(a.price*a.quantity)})]},T)),e.jsxs("tr",{className:"bg-gray-50",children:[e.jsx("td",{colSpan:3,className:"px-4 py-3 text-right font-medium",children:"Total"}),e.jsx("td",{className:"px-4 py-3 text-right font-bold",children:n(s.amount)})]})]})]})})})]})]}):e.jsxs(t,{variant:"destructive",children:[e.jsx(x,{className:"h-4 w-4"}),e.jsx(r,{children:"Pagamento não encontrado"}),e.jsx(c,{children:"Não encontramos os detalhes deste pagamento. Ele pode ter sido removido ou o ID está incorreto."})]})]})})}export{$ as default};
